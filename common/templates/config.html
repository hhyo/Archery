{% extends "base.html" %}
{% load i18n %}
{% load format_tags %}

{% block content %}
    <div class="row clearfix">
        <div class="col-md-3">
            <div class="panel panel-default">
                <div class="panel-heading">{% trans "Select Operation" %}</div>
                <div class="panel-body">
                    <div id="div-config" class="form-group">
                        <h5 class="control-label text-bold">{% trans "Configuration:" %}</h5>
                        <div class="form-group">
                            <select id="config" name="confg"
                                    class="selectpicker show-tick form-control bs-select-hidden"
                                    data-name="Configuration" data-placeholder="{% trans 'Select Configuration:' %}" required />
                                <option value="is-empty" disabled="">{% trans "Select Configuration:" %}</option>
                                <option value="0" selected="selected">{% trans "System Settings" %}</option>
                                <option value="1">{% trans "Workflow Audit Configuration" %}</option>
                            </select>
                        </div>
                    </div>
                    <div id="div-workflow" class="form-group" style="display: none">
                        <h5 class="control-label text-bold">{% trans "Workflow Type:" %}</h5>
                        <div class="form-group">
                            <select id="workflow_type" name="group"
                                    class="selectpicker show-tick form-control bs-select-hidden"
                                    data-name="Ticket Type" data-placeholder="{% trans 'Select Workflow Type:' %}" required />
                                {% for c in workflow_choices %}
                                {% if forloop.first %}
                                <option value="{{ c.value }}" selected="selected">
                                {{ c.label }}</option>
                                {% else %}
                                <option value="{{ c.value }}">
                                {{ c.label }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <h5 class="control-label text-bold">{% trans "Group:" %}</h5>
                        <div class="form-group">
                            <select id="group" name="group"
                                    class="selectpicker show-tick form-control bs-select-hidden"
                                    data-name="Group" data-placeholder="{% trans 'Select Group:' %}" data-live-search="true" required />
                                {% for group in group_list %}
                                    <option value="{{ group.group_name }}">{{ group.group_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-9 column">
            <div class="panel panel-default">
                <div class="panel-heading">{% trans "Operations" %}</div>
                <div class="panel-body">
                    <div id="div-system-config" class="form-group" style="display: none">
                        <h4 style="color: darkgrey; display: inline;"><b>{% trans "goInception Configuration" %}</b></h4>&nbsp;&nbsp;&nbsp;
                        <h6 style="color:red">Note1：Backup DB info is only for getting rollback SQL，needs to match audit tool config，changes here wont modify audit tool config</h6>
                        <hr/>
                        <div class="form-horizontal">
                            <div id="div-go-inception-config">
                                <div class="form-group">
                                    <label for="go_inception_host"
                                           class="col-sm-4 control-label">GO_INCEPTION_HOST</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="go_inception_host"
                                               key="go_inception_host"
                                               value="{{ config.go_inception_host }}"
                                               placeholder="{% trans 'goInception Address' %}" />
                                    </div>
                                    <button id='check_goincption' class='btn-sm btn-info'>{% trans "Test Connection" %}</button>&nbsp;
                                </div>
                                <div class="form-group">
                                    <label for="go_inception_port"
                                           class="col-sm-4 control-label">GO_INCEPTION_PORT</label>
                                    <div class="col-sm-5">
                                        <input type="number" class="form-control"
                                               id="go_inception_port"
                                               key="go_inception_port"
                                               value="{{ config.go_inception_port }}"
                                               placeholder="goInceptionPort" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="go_inception_user"
                                           class="col-sm-4 control-label">GO_INCEPTION_USER</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="go_inception_user"
                                               key="go_inception_user"
                                               value="{{ config.go_inception_user }}"
                                               placeholder="{% trans 'goInception User (leave empty if auth not enabled)' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="go_inception_password"
                                           class="col-sm-4 control-label">GO_INCEPTION_PASSWORD</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="go_inception_password"
                                               key="go_inception_password"
                                               value="{{ config.go_inception_password }}"
                                               placeholder="{% trans 'goInception Password (leave empty if auth not enabled)' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inception_remote_backup_host"
                                       class="col-sm-4 control-label">BACKUP_HOST</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="inception_remote_backup_host"
                                           key="inception_remote_backup_host"
                                           value="{{ config.inception_remote_backup_host }}"
                                           placeholder="{% trans 'Backup Host' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inception_remote_backup_port"
                                       class="col-sm-4 control-label">BACKUP_PORT</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control"
                                           id="inception_remote_backup_port"
                                           key="inception_remote_backup_port"
                                           value="{{ config.inception_remote_backup_port }}"
                                           placeholder="{% trans 'Backup Port' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inception_remote_backup_user"
                                       class="col-sm-4 control-label">BACKUP_USER</label>
                                <div class="col-sm-5">
                                    <input type="text" autocomplete="new-password" class="form-control"
                                           id="inception_remote_backup_user"
                                           key="inception_remote_backup_user"
                                           value="{{ config.inception_remote_backup_user }}"
                                           placeholder="{% trans 'Backup User' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inception_remote_backup_password"
                                       class="col-sm-4 control-label">BACKUP_PASSWORD</label>
                                <div class="col-sm-5">
                                    <input type="password" autocomplete="new-password" class="form-control"
                                           id="inception_remote_backup_password"
                                           key="inception_remote_backup_password"
                                           value="{{ config.inception_remote_backup_password }}"
                                           placeholder="{% trans 'Backup Password' %}" />
                                </div>
                            </div>
                        </div>
                        <br>
                        <h4 style="color: darkgrey"><b>{% trans "Feature Module Configuration" %}</b></h4>
                        <hr/>
                        <h5 style="color: darkgrey"><b>{% trans "SQL Deployment" %}</b></h5>
                        <hr/>
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="critical_ddl_regex"
                                       class="col-sm-4 control-label">CRITICAL_DDL_REGEX</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="critical_ddl_regex"
                                           key="critical_ddl_regex"
                                           value="{{ config.critical_ddl_regex }}"
                                           placeholder="{% trans 'Regex pattern - matched statements will be blocked from submission' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="auto_review_wrong"
                                       class="col-sm-4 control-label">AUTO_REVIEW_WRONG</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control"
                                           id="auto_review_wrong"
                                           key="auto_review_wrong"
                                           value="{{ config.auto_review_wrong }}"
                                           placeholder="{% trans 'Auto-reject level: 1=reject on warning, 2 or empty=reject on error only, other=no reject' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="enable_backup_switch"
                                       class="col-sm-4 control-label">ENABLE_BACKUP_SWITCH</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="enable_backup_switch"
                                                   key="enable_backup_switch"
                                                   value="{{ config.enable_backup_switch }}"
                                                   type="checkbox" />
                                            {% trans "Enable backup option (disabled by default, requires backup)" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="auto_review"
                                       class="col-sm-4 control-label">AUTO_REVIEW</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="auto_review"
                                                   key="auto_review"
                                                   value="{{ config.auto_review }}"
                                                   type="checkbox" />
                                            {% trans "Enable SQL deployment auto-approval" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div id="div-auto-review-config" style="display: none">
                                <div class="form-group">
                                    <label for="auto_review_tag"
                                           class="col-sm-4 control-label">AUTO_REVIEW_TAG</label>
                                    <div class="col-sm-5">
                                        <select id="auto_review_tag" key="auto_review_tag"
                                                class="form-control selectpicker" data-live-search="true"
                                                multiple data-selected-text-format="count > 5"
                                                data-none-selected-text="{% trans 'Auto-approval instance tags' %}">
                                            {% for tag in instance_tags %}
                                                {% if tag.tag_code|is_in:config.auto_review_tag %}
                                                    <option value="{{ tag.tag_code }}"
                                                            selected>{{ tag.tag_name }}</option>
                                                {% else %}
                                                    <option value="{{ tag.tag_code }}">{{ tag.tag_name }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="auto_review_db_type"
                                           class="col-sm-4 control-label">AUTO_REVIEW_DB_TYPE</label>
                                    <div class="col-sm-5">
                                        <select id="auto_review_db_type" key="auto_review_db_type"
                                                class="form-control selectpicker" data-live-search="true"
                                                multiple data-selected-text-format="count > 5"
                                                data-none-selected-text="{% trans 'Auto-approval database types' %}">
                                            {% for type in db_type %}
                                                {% if type|is_in:config.auto_review_db_type %}
                                                    <option value="{{ type }}" selected>{{ type }}</option>
                                                {% else %}
                                                    <option value="{{ type }}">{{ type }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="auto_review_regex"
                                           class="col-sm-4 control-label">AUTO_REVIEW_REGEX</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="auto_review_regex"
                                               key="auto_review_regex"
                                               value="{{ config.auto_review_regex }}"
                                               placeholder="{% trans 'Regex pattern - matched statements require manual approval' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="auto_review_max_update_rows"
                                           class="col-sm-4 control-label">MAX_UPDATE_ROWS</label>
                                    <div class="col-sm-5">
                                        <input type="number" class="form-control"
                                               id="auto_review_max_update_rows"
                                               key="auto_review_max_update_rows"
                                               value="{{ config.auto_review_max_update_rows }}"
                                               placeholder="{% trans 'Max update rows allowed for auto-approval' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="manual"
                                       class="col-sm-4 control-label">MANNUAL</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="manual"
                                                   key="manual"
                                                   value="{{ config.manual }}"
                                                   type="checkbox" />
                                            {% trans "Enable SQL deployment manual execution confirmation" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ddl_dml_separation"
                                       class="col-sm-4 control-label">DDL_DML_SEPARATION</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="ddl_dml_separation"
                                                   key="ddl_dml_separation"
                                                   value="{{ config.ddl_dml_separation }}"
                                                   type="checkbox" />
                                            {% trans "Prohibit DDL and DML from being submitted together (MySQL)" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ban_self_audit"
                                       class="col-sm-4 control-label">BAN_SELF_AUDIT</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <input id="ban_self_audit"
                                                  key="ban_self_audit"
                                                  value="{{ config.ban_self_audit }}"
                                                  type="checkbox" />
                                        <label for="ban_self_audit" title="{% trans 'ON: Prohibit self-review. OFF: Allow self-approval' %}">{% trans "Prohibit self-review (except admins)" %}</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="real_row_count"
                                       class="col-sm-4 control-label">REAL_ROW_COUNT</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="real_row_count"
                                                   key="real_row_count"
                                                   value="{{ config.real_row_count }}"
                                                   type="checkbox">
                                            {% trans "Get actual DML affected rows (MySQL, MongoDB)" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h5 style="color: darkgrey"><b>{% trans "SQL Query" %}</b></h5>
                        <h6 style="color:red">{% trans "Note: Data masking requires goInception configuration for SQL syntax parsing" %}</h6>
                        <hr/>
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="data_masking"
                                       class="col-sm-4 control-label">DATA_MASKING</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="data_masking"
                                                   key="data_masking"
                                                   value="{{ config.data_masking }}" type="checkbox" />
                                            {% trans "Enable dynamic data masking" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="query_check"
                                       class="col-sm-4 control-label">QUERY_CHECK</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="query_check"
                                                   key="query_check"
                                                   value="{{ config.query_check }}" type="checkbox" />
                                            {% trans "Enable masking validation (statements that cannot be masked will throw error)" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="disable_star"
                                       class="col-sm-4 control-label">DISABLE_STAR</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="disable_star"
                                                   key="disable_star"
                                                   value="{{ config.disable_star }}" type="checkbox" />
                                            {% trans "Prohibit using * in queries" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="max_execution_time"
                                       class="col-sm-4 control-label">MAX_EXECUTION_TIME</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control" id="max_execution_time"
                                           key="max_execution_time"
                                           value="{{ config.max_execution_time }}"
                                           placeholder="{% trans 'Online query timeout threshold in seconds, default 60' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="admin_query_limit"
                                       class="col-sm-4 control-label">ADMIN_QUERY_LIMIT</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control" id="admin_query_limit"
                                           key="admin_query_limit"
                                           value="{{ config.admin_query_limit }}"
                                           placeholder="{% trans 'Admin/DBA query result set limit' %}" />
                                </div>
                            </div>

                            <!-- Data Export Config -->
                            <h5 style="color: darkgrey"><b>{% trans "Data Export Configuration" %}</b></h5>
                            <hr/>
                            <div id="offline_download_export_msg">
                                <div class="form-group">
                                    <label for="max_export_rows"
                                           class="col-sm-4 control-label">MAX_EXPORT_ROWS</label>
                                    <div class="col-sm-5">
                                        <input type="number" class="form-control" id="max_export_rows"
                                               key="max_export_rows"
                                               value="{{ config.max_export_rows }}"
                                               placeholder="{% trans 'Export row limit, default: 10000' %}">
                                    </div>
                                </div>
                            </div>

                            <!-- Storage Type Selection -->
                            <h5 style="color: darkgrey"><b>{% trans "Storage Type Selection" %}</b></h5>
                            <hr/>
                            <div class="form-group">
                                <label for="storage_type" class="col-sm-4 control-label">{% trans "Storage Type" %}</label>
                                <div class="col-sm-5">
                                    <select id="storage_type" 
                                            key="storage_type"
                                            class="form-control selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            onchange="showStorageConfig()">
                                        <option value="local">{% trans "Local Storage" %}</option>
                                        <option value="sftp">SFTP</option>
                                        <option value="s3c">{% trans "S3 Compatible Storage" %}</option>
                                        <option value="azure">Azure Blob</option>
                                    </select>
                                </div>
                                <button id='check_storage_conn' class='btn-sm btn-info'>{% trans "Test Connection" %}</button>
                            </div>

                            <!-- Dynamic config area -->
                            <div id="dynamic-config">
                                <!-- Local storage config -->
                                <div id="storage-local" class="storage-config" style="display: none;">
                                    <div class="form-group">
                                        <label for="local-path" class="col-sm-4 control-label">{% trans "Local Storage Path" %}</label>
                                        <div class="col-sm-5">
                                            <input type="text" class="form-control" disabled
                                                   placeholder="{% trans 'Project root/downloads/DataExportFile/' %}">
                                        </div>
                                    </div>
                                </div>
                                <!-- SFTP Config -->
                                <div id="storage-sftp" class="storage-config" style="display: none;">
                                    <div class="form-group">
                                        <label for="sftp-host" class="col-sm-4 control-label">{% trans "SFTP Host" %}</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="sftp_host"
                                               key="sftp_host"
                                               value="{{ config.sftp_host }}"
                                               placeholder="{% trans 'SFTP service IP address' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sftp-port" class="col-sm-4 control-label">{% trans "SFTP Port" %}</label>
                                        <div class="col-sm-5">
                                        <input type="number" class="form-control" id="sftp_port"
                                               key="sftp_port"
                                               value="{{ config.sftp_port }}"
                                               placeholder="{% trans 'SFTP service port' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sftp-user" class="col-sm-4 control-label">{% trans "SFTP Username" %}</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="sftp_user"
                                               key="sftp_user"
                                               value="{{ config.sftp_user }}"
                                               placeholder="{% trans 'SFTP username' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sftp-password" class="col-sm-4 control-label">{% trans "SFTP Password" %}</label>
                                        <div class="col-sm-5">
                                        <input type="password" class="form-control" id="sftp_password"
                                               key="sftp_password"
                                               value="{{ config.sftp_password }}"
                                               placeholder="{% trans 'SFTP password' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sftp-password" class="col-sm-4 control-label">{% trans "SFTP Path" %}</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="sftp_path"
                                               key="sftp_path"
                                               value="{{ config.sftp_path }}"
                                               placeholder="{% trans 'SFTP storage path' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sftp-custom-params" class="col-sm-4 control-label">{% trans "Custom Parameters" %}</label>
                                        <div class="col-sm-5">
                                            <input type="text" class="form-control"
                                                   id="sftp_custom_params"
                                                   key="sftp_custom_params"
                                                   value="{{ config.sftp_custom_params }}"
                                                   placeholder="{% trans 'Enter JSON format custom parameters, e.g.: {\"key\": \"value\"}' %}">
                                        </div>
                                    </div>
                                </div>
                                <!-- S3 compatible backend storage config -->
                                <div id="storage-s3c" class="storage-config" style="display: none;">
                                    <div class="form-group">
                                        <label for="s3c-access-key-id" class="col-sm-4 control-label">Access Key</label>
                                        <div class="col-sm-5">
                                        <input type="password" class="form-control" id="s3c_access_key_id"
                                               key="s3c_access_key_id"
                                               value="{{ config.s3c_access_key_id }}"
                                               placeholder="Access Key">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="s3c-access-key-secret" class="col-sm-4 control-label">Secret Key</label>
                                        <div class="col-sm-5">
                                        <input type="password" class="form-control" id="s3c_access_key_secret"
                                               key="s3c_access_key_secret"
                                               value="{{ config.s3c_access_key_secret }}"
                                               placeholder="Secret Key">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="s3c-endpoint" class="col-sm-4 control-label">Endpoint URL</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="s3c_endpoint"
                                               key="s3c_endpoint"
                                               value="{{ config.s3c_endpoint }}"
                                               placeholder="Endpoint URL">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="s3c-region" class="col-sm-4 control-label">Region</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="s3c_region"
                                               key="s3c_region"
                                               value="{{ config.s3c_region }}"
                                               placeholder="{% trans 'Region (optional)' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="s3c-bucket-name" class="col-sm-4 control-label">Bucket</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="s3c_bucket_name"
                                               key="s3c_bucket_name"
                                               value="{{ config.s3c_bucket_name }}"
                                               placeholder="Bucket Name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="s3c-path" class="col-sm-4 control-label">Path</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="s3c_path"
                                               key="s3c_path"
                                               value="{{ config.s3c_path }}"
                                               placeholder="{% trans 'Storage path, no leading /' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="s3c-custom-params" class="col-sm-4 control-label">CustomParameter</label>
                                        <div class="col-sm-5">
                                            <input type="textarea" class="form-control"
                                                   id="s3c_custom_params"
                                                   key="s3c_custom_params"
                                                   value="{{ config.s3c_custom_params }}"
                                                   placeholder="{% trans 'Enter JSON format custom parameters, e.g.: {\"key\": \"value\"}' %}">
                                        </div>
                                    </div>
                                </div>
                                <!-- AzureConfig -->
                                <div id="storage-azure" class="storage-config" style="display: none;">
                                    <div class="form-group">
                                        <label for="azure-container" class="col-sm-4 control-label">{% trans "Azure Container" %}</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="azure_container"
                                               key="azure_container"
                                               value="{{ config.azure_container }}"
                                               placeholder="{% trans 'Azure account name' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="azure-account-name" class="col-sm-4 control-label">{% trans "Azure Account Name" %}</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="azure_account_name"
                                               key="azure_account_name"
                                               value="{{ config.azure_account_name }}"
                                               placeholder="{% trans 'Azure account name' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="azure-account-key" class="col-sm-4 control-label">{% trans "Azure Account Key" %}</label>
                                        <div class="col-sm-5">
                                        <input type="password" class="form-control" id="azure_account_key"
                                               key="azure_account_key"
                                               value="{{ config.azure_account_key }}"
                                               placeholder="{% trans 'Azure account key' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="azure-path" class="col-sm-4 control-label">Azure Path</label>
                                        <div class="col-sm-5">
                                        <input type="text" class="form-control" id="azure_path"
                                               key="azure_path"
                                               value="{{ config.azure_path }}"
                                               placeholder="{% trans 'Azure storage path, no leading /, e.g. tmp/' %}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="azure-custom-params" class="col-sm-4 control-label">CustomParameter</label>
                                        <div class="col-sm-5">
                                            <input type="text" class="form-control"
                                                   id="azure_custom_params"
                                                   key="azure_custom_params"
                                                   value="{{ config.azure_custom_params }}"
                                                   placeholder="{% trans 'Enter JSON format custom parameters, e.g.: {\"key\": \"value\"}' %}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        <script>
                            
                            function showStorageConfig() {
                                const storageType = document.getElementById('storage_type').value;
                                
                                document.querySelectorAll('.storage-config').forEach(elem => {
                                    elem.style.display = 'none';
                                });
                                
                                document.getElementById(`storage-${storageType}`).style.display = 'block';
                            }

                            
                            window.onload = function() {
                                document.getElementById('storage_type').value = "{{ config.storage_type }}";
                                showStorageConfig();
                            };
                        </script>

                            <h5 style="color: darkgrey"><b>SQLOptimize</b></h5>
                            <hr/>
                            <div class="form-group">
                                <label for="sqladvisor"
                                       class="col-sm-4 control-label">SQLADVISOR_PATH</label>
                                <div class="col-sm-5">
                                    <div class="switch switch-small">
                                        <input type="text" class="form-control" id="sqladvisor" key="sqladvisor"
                                               value="{{ config.sqladvisor }}"
                                               placeholder="{% trans 'SQLADVISOR path' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="soar"
                                       class="col-sm-4 control-label">SOAR_PATH</label>
                                <div class="col-sm-5">
                                    <div class="switch switch-small">
                                        <input type="text" class="form-control" id="soar" key="soar"
                                               value="{{ config.soar }}"
                                               placeholder="{% trans 'SOAR path' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="soar_test_dsn"
                                       class="col-sm-4 control-label">SOAR_TEST_DSN</label>
                                <div class="col-sm-5">
                                    <div class="switch switch-small">
                                        <input type="text" class="form-control" id="soar_test_dsn" key="soar_test_dsn"
                                               value="{{ config.soar_test_dsn }}"
                                               placeholder="SOARTestInstance：user:pwd@host:port/db" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <h4 style="color: darkgrey;display: inline"><b>{% trans "Notification Configuration" %}</b></h4>&nbsp;&nbsp;&nbsp;
                        <h6 style="color:red">{% trans "Note 1: DingTalk Webhook requires configuring group Webhook address. Webhook cannot notify specific users." %}</h6>
                        <h6 style="color:red">{% trans "Note 2: After enabling WeChat Work app, if WeChat Work UserID is not configured, username will be used as UserId by default." %}</h6>
                        <h6 style="color:red">{% trans "Note 3: WeChat Work group bot requires configuring group webhook address. Group bot notifies groups; WeChat Work app can notify specific users." %}</h6>
                        <hr/>
                        <div class="form-horizontal">
                        <h5 style="color: darkgrey"><b>{% trans "Ticket Notification" %}</b></h5>
                            <hr/>
                            <div class="form-group">
                                <label for="archery_base_url"
                                       class="col-sm-4 control-label">ARCHERY_BASE_URL</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="archery_base_url"
                                           key="archery_base_url"
                                           value="{{ config.archery_base_url }}"
                                           placeholder="{% trans 'System HOST address for notification links, e.g. https://archery.com' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ddl_notify_auth_group"
                                       class="col-sm-4 control-label">DDL_NOTIFY_AUTH_GROUP</label>
                                <div class="col-sm-5">
                                    <select id="ddl_notify_auth_group" key="ddl_notify_auth_group"
                                            class="selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            data-none-selected-text="{% trans 'DDL ticket notification permission groups' %}"
                                            multiple data-selected-text-format="count > 3"
                                            required>
                                        {% for auth_group in auth_group_list %}
                                            {% if auth_group.name|is_in:config.ddl_notify_auth_group %}
                                                <option value="{{ auth_group.name }}"
                                                        selected>{{ auth_group.name }}</option>
                                            {% else %}
                                                <option value="{{ auth_group.name }}">{{ auth_group.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notify_phase_control"
                                       class="col-sm-4 control-label">NOTIFY_PHASE_CONTROL</label>
                                <div class="col-sm-5">
                                    <select id="notify_phase_control" key="notify_phase_control"
                                            class="selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            data-none-selected-text="{% trans 'Ticket notification stage control' %}"
                                            multiple required>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="mail"
                                       class="col-sm-4 control-label">MAIL</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="mail" key="mail" value="{{ config.mail }}"
                                                   type="checkbox" /> {% trans "Enable email notification" %}
                                        </label>
                                        <button id='check_email' class='btn-sm btn-info'>{% trans "Test Connection" %}</button>
                                    </div>
                                </div>
                            </div>
                            <div id="div-mail-config" style="display: none">
                                <div class="form-group">
                                    <label for="mail_ssl"
                                           class="col-sm-4 control-label">MAIL_SSL</label>
                                    <div class="col-sm-8">
                                        <div class="switch switch-small">
                                            <label>
                                                <input id="mail_ssl" key="mail_ssl"
                                                       value="{{ config.mail_ssl }}"
                                                       type="checkbox" /> {% trans "Use SSL" %}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mail_smtp_server"
                                           class="col-sm-4 control-label">MAIL_SMTP_SERVER</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="mail_smtp_server"
                                               key="mail_smtp_server"
                                               value="{{ config.mail_smtp_server }}"
                                               placeholder="{% trans 'Email SMTP address' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mail_smtp_port"
                                           class="col-sm-4 control-label">MAIL_SMTP_PORT</label>
                                    <div class="col-sm-5">
                                        <input type="number" class="form-control"
                                               id="mail_smtp_port"
                                               key="mail_smtp_port"
                                               value="{{ config.mail_smtp_port }}"
                                               placeholder="{% trans 'Email SMTP port' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mail_smtp_user"
                                           class="col-sm-4 control-label">MAIL_SMTP_USER</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="mail_smtp_user"
                                               key="mail_smtp_user"
                                               value="{{ config.mail_smtp_user }}"
                                               placeholder="{% trans 'Email account' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mail_smtp_password"
                                           class="col-sm-4 control-label">MAIL_SMTP_PASSWORD</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="mail_smtp_password"
                                               key="mail_smtp_password"
                                               value="{{ config.mail_smtp_password }}"
                                               placeholder="{% trans 'Email account password' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ding"
                                       class="col-sm-4 control-label">DING</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="ding" key="ding" value="{{ config.ding }}"
                                                   type="checkbox" /> {% trans "Enable DingTalk Webhook notification" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ding_to_person"
                                       class="col-sm-4 control-label">DING_TO_PERSON</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="ding_to_person" key="ding_to_person"
                                                   value="{{ config.ding_to_person }}"
                                                   type="checkbox" /> {% trans "Enable DingTalk personal message notification" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div id="div-ding-config" style="display: none">
                                <div class="form-group">
                                    <i class="ace-icon fa fa-hand-o-right"></i>
                                    {% trans "Create DingTalk Archery mini-app reference:" %} <a target="_blank"
                                                        href="https://ding-doc.dingtalk.com/doc#/bgb96b/aw3h75">{% trans "DingTalk Enterprise Development Documentation" %}</a>
                                    &nbsp;&nbsp;&nbsp;<button id='sync_ding_user' class='btn-xs btn-warning'>SyncUser
                                </button>
                                </div>
                                <div class="form-group">
                                    <label for="ding_agent_id"
                                           class="col-sm-4 control-label">AgentId</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="ding_agent_id"
                                               key="ding_agent_id"
                                               value="{{ config.ding_agent_id }}"
                                               placeholder="{% trans 'Archery mini-app AgentId' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ding_app_key"
                                           class="col-sm-4 control-label">AppKey</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="ding_app_key"
                                               key="ding_app_key"
                                               value="{{ config.ding_app_key }}"
                                               placeholder="{% trans 'Archery mini-app AppKey' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ding_app_secret"
                                           class="col-sm-4 control-label">AppSecret</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="ding_app_secret"
                                               key="ding_app_secret"
                                               value="{{ config.ding_app_secret }}"
                                               placeholder="{% trans 'Archery mini-app AppSecret' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ding_archery_username"
                                           class="col-sm-4 control-label">Archery2Ding</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="ding_archery_username"
                                               key="ding_archery_username"
                                               value="{{ config.ding_archery_username }}"
                                               placeholder="{% trans 'Column in DingTalk corresponding to Archery.username' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ding_dept_ids"
                                           class="col-sm-4 control-label">DingDeptIDs</label>
                                    <div class="col-sm-5">
                                        <textarea class="form-control"
                                                  id="ding_dept_ids"
                                                  key="ding_dept_ids"
                                                  placeholder="{% trans 'DingTalk department IDs, comma separated' %}">{{ config.ding_dept_ids }}</textarea />
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="wx"
                                       class="col-sm-4 control-label">{% trans "WeChat Work App" %}</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="wx" key="wx"
                                                   value="{{ config.wx }}"
                                                   type="checkbox" /> {% trans "Enable WeChat Work app notification" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div id="div-wx-config" style="display: none">
                                <div class="form-group">
                                    <i class="ace-icon fa fa-hand-o-right"></i>
                                    {% trans "Create WeChat Work app reference:" %} <a target="_blank"
                                                  href="https://work.weixin.qq.com/api/doc#90000/90135/90226">{% trans "WeChat Work Development Documentation" %}</a>
                                    {#                                    &nbsp;&nbsp;&nbsp;<button id='sync_ding_user' class='btn-xs btn-warning'>SyncUser#}
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label for="wx_corpid"
                                           class="col-sm-4 control-label">CorpId</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="wx_corpid"
                                               key="wx_corpid"
                                               value="{{ config.wx_corpid }}"
                                               placeholder="{% trans 'WeChat Work Corp ID' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wx_agent_id"
                                           class="col-sm-4 control-label">AgentId</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="wx_agent_id"
                                               key="wx_agent_id"
                                               value="{{ config.wx_agent_id }}"
                                               placeholder="{% trans 'App AgentId' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wx_app_secret"
                                           class="col-sm-4 control-label">Secret</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="wx_app_secret"
                                               key="wx_app_secret"
                                               value="{{ config.wx_app_secret }}"
                                               placeholder="{% trans 'App Secret' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="qywx_webhook"
                                       class="col-sm-4 control-label">{% trans "WeChat Work Group Bot" %}</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="qywx_webhook" key="qywx_webhook"
                                                   value="{{ config.qywx_webhook }}"
                                                   type="checkbox" /> {% trans "Enable WeChat Work group bot notification" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="feishu_webhook"
                                       class="col-sm-4 control-label">{% trans "Feishu Webhook" %}</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="feishu_webhook" key="feishu_webhook"
                                                   value="{{ config.feishu_webhook }}"
                                                   type="checkbox" /> {% trans "Enable Feishu Webhook notification" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="feishu"
                                       class="col-sm-4 control-label">{% trans "Feishu" %}</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="feishu" key="feishu"
                                                   value="{{ config.feishu }}"
                                                   type="checkbox" /> {% trans "Enable Feishu notification" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div id="div-feishu-config" style="display: none">
                                <div class="form-group">
                                    <i class="ace-icon fa fa-hand-o-right"></i>
                                    {% trans "Create Feishu app reference:" %} <a target="_blank"
                                                href="https://open.feishu.cn/document/uQjL04CN/ukzM04SOzQjL5MDN">{% trans "Feishu Development Documentation" %}</a>
                                    {#                                    &nbsp;&nbsp;&nbsp;<button id='sync_ding_user' class='btn-xs btn-warning'>SyncUser#}
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label for="feishu_appid"
                                           class="col-sm-4 control-label">{% trans "Feishu App ID" %}</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="feishu_appid"
                                               key="feishu_appid"
                                               value="{{ config.feishu_appid }}"
                                               placeholder="{% trans 'Feishu App ID' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="feishu_app_secret"
                                           class="col-sm-4 control-label">{% trans "Feishu AppSecret" %}</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="feishu_app_secret"
                                               key="feishu_app_secret"
                                               value="{{ config.feishu_app_secret }}"
                                               placeholder="{% trans 'Feishu AppSecret' %}" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="generic_webhook_url"
                                       class="col-sm-4 control-label">{% trans "Generic Webhook URL" %}</label>
                                <div class="col-sm-5">
                                    <input class="form-control"
                                           id="generic_webhook_url"
                                           key="generic_webhook_url"
                                           value="{{ config.generic_webhook_url }}"
                                           placeholder="{% trans 'Generic webhook URL, called on every status change of each workflow' %}" />
                                </div>
                            </div>
                            <h5 style="color: darkgrey"><b>{% trans "SMS Service" %}</b></h5>
                            <hr/>
                            <div class="form-group">
                                <label for="sms_provider"
                                       class="col-sm-4 control-label">{% trans "SMS Service Provider" %}</label>
                                <div class="col-sm-5">
                                    <select id="sms_provider" key="sms_provider"
                                            class="selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            data-none-selected-text="{% trans 'SMS Provider' %}"
                                            required>
                                    </select>
                                </div>
                            </div>
                            <div id="aliyun_sms" style="display: none">
                                <div class="form-group">
                                    <label for="aliyun_access_key_id"
                                           class="col-sm-4 control-label">ALIYUN_ACCESS_KEY_ID</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="aliyun_access_key_id"
                                               key="aliyun_access_key_id"
                                               value="{{ config.aliyun_access_key_id }}"
                                               placeholder="{% trans 'Aliyun Access Key ID, used to identify User' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="aliyun_access_key_secret"
                                           class="col-sm-4 control-label">ALIYUN_ACCESS_KEY_SECRET</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="aliyun_access_key_secret"
                                               key="aliyun_access_key_secret"
                                               value="{{ config.aliyun_access_key_secret }}"
                                               placeholder="{% trans 'Aliyun Access Key Secret, used to verify User identity' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="aliyun_sign_name"
                                           class="col-sm-4 control-label">ALIYUN_SIGN_NAME</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="aliyun_sign_name"
                                               key="aliyun_sign_name"
                                               value="{{ config.aliyun_sign_name }}"
                                               placeholder="{% trans 'SMS signature, must be approved status' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="aliyun_template_code"
                                           class="col-sm-4 control-label">ALIYUN_TEMPLATE_CODE</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="aliyun_template_code"
                                               key="aliyun_template_code"
                                               value="{{ config.aliyun_template_code }}"
                                               placeholder="{% trans 'SMS template code, must be approved status' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="aliyun_variable_name"
                                           class="col-sm-4 control-label">ALIYUN_VARIABLE_NAME</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="aliyun_variable_name"
                                               key="aliyun_variable_name"
                                               value="{{ config.aliyun_variable_name }}"
                                               placeholder="{% trans 'Variable name in SMS template, e.g.: code' %}" />
                                    </div>
                                </div>
                            </div>
                            <div id="tencent_sms" style="display: none">
                                <div class="form-group">
                                    <label for="tencent_secret_id"
                                           class="col-sm-4 control-label">TENCENT_SECRET_ID</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="tencent_secret_id"
                                               key="tencent_secret_id"
                                               value="{{ config.tencent_secret_id }}"
                                               placeholder="{% trans 'Used to identify API caller identity' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="tencent_secret_key"
                                           class="col-sm-4 control-label">TENCENT_SECRET_KEY</label>
                                    <div class="col-sm-5">
                                        <input type="password" class="form-control"
                                               id="tencent_secret_key"
                                               key="tencent_secret_key"
                                               value="{{ config.tencent_secret_key }}"
                                               placeholder="{% trans 'Key used for encrypting signature and server-side verification' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="tencent_sign_name"
                                           class="col-sm-4 control-label">TENCENT_SIGN_NAME</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="tencent_sign_name"
                                               key="tencent_sign_name"
                                               value="{{ config.tencent_sign_name }}"
                                               placeholder="{% trans 'SMS signature, must be approved status' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="tencent_template_id"
                                           class="col-sm-4 control-label">TENCENT_TEMPLATE_ID</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="tencent_template_id"
                                               key="tencent_template_id"
                                               value="{{ config.tencent_template_id }}"
                                               placeholder="{% trans 'SMS template ID, must be approved status' %}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="tencent_sdk_appid"
                                           class="col-sm-4 control-label">TENCENT_SDK_APPID</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control"
                                               id="tencent_sdk_appid"
                                               key="tencent_sdk_appid"
                                               value="{{ config.tencent_sdk_appid }}"
                                               placeholder="{% trans 'SMS Application ID' %}" />
                                    </div>
                                </div>
                            </div>
                        <br>
                        </div>

                        <h4 style="color: darkgrey; display: inline;"><b>OIDC Config</b></h4>
                        <hr/>

                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="index_path_url"
                                       class="col-sm-4 control-label">OIDC_BTN_NAME</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="oidc_btn_name"
                                           key="oidc_btn_name"
                                           value="{{ config.oidc_btn_name }}"
                                           placeholder="{% trans 'Login button display name, e.g. Login With KeyCloak' %}" />
                                </div>
                            </div>
                        </div>
                        
                        <h4 style="color: darkgrey; display: inline;"><b>OPENAI Config</b></h4>
                        <h6 style="color:red">{% trans "Note 1: If OPENAI_API_KEY is not configured, related features will not be enabled" %}</h6>
                        <h6 style="color:red">{% trans "Note 2: DEFAULT_CHAT_MODEL defaults to gpt-3.5-turbo, DEFAULT_QUERY_TEMPLATE defaults to system-defined template" %}</h6>
                        <hr/>
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="openai_base_url"
                                       class="col-sm-4 control-label">OPENAI_BASE_URL</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" id="openai_base_url"
                                           key="openai_base_url"
                                           value="{{ config.openai_base_url }}"
                                           placeholder="openai base url" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="openai_api_key"
                                       class="col-sm-4 control-label">OPENAI_API_KEY</label>
                                <div class="col-sm-5">
                                    <input type="password" class="form-control" id="openai_api_key"
                                           key="openai_api_key"
                                           value="{{ config.openai_api_key }}"
                                           placeholder="openai api key" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="default_chat_model"
                                       class="col-sm-4 control-label">DEFAULT_CHAT_MODEL</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" id="default_chat_model"
                                           key="default_chat_model"
                                           value="{{ config.default_chat_model }}"
                                           placeholder="openai default chat model" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="default_query_template"
                                       class="col-sm-4 control-label">DEFAULT_QUERY_TEMPLATE</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" id="default_query_template"
                                           key="default_query_template"
                                           value="{{ config.default_query_template }}"
                                           placeholder="{% trans 'Default Django template for generating SQL statements, empty template will cause generation to fail, requires db_type/table_schema/user_input' %}" />
                                </div>
                            </div>
                        </div>

                        <h4 style="color: darkgrey"><b>{% trans "Other Configuration" %}</b></h4>
                        <hr/>
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label for="index_path_url"
                                       class="col-sm-4 control-label">INDEX_PATH_URL</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="index_path_url"
                                           key="index_path_url"
                                           value="{{ config.index_path_url }}"
                                           placeholder="{% trans 'System homepage path, default is SQL workflow page: sqlworkflow' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="my2sql"
                                       class="col-sm-4 control-label">MY2SQL</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="my2sql"
                                           key="my2sql"
                                           value="{{ config.my2sql }}"
                                           placeholder="{% trans 'my2sql call path, e.g. /opt/archery/src/plugins/my2sql' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="default_auth_group"
                                       class="col-sm-4 control-label">DEFAULT_AUTH_GROUP</label>
                                <div class="col-sm-5">
                                    <select id="default_auth_group" key="default_auth_group"
                                            class="selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            data-none-selected-text="{% trans 'Permission groups automatically assigned to new users on first login' %}"
                                            multiple data-selected-text-format="count > 3"
                                            required>
                                        {% for auth_group in auth_group_list %}
                                            {% if auth_group.name|is_in:config.default_auth_group %}
                                                <option value="{{ auth_group.name }}"
                                                        selected>{{ auth_group.name }}</option>
                                            {% else %}
                                                <option value="{{ auth_group.name }}">{{ auth_group.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="default_resource_group"
                                       class="col-sm-4 control-label">DEFAULT_RESOURCE_GROUP</label>
                                <div class="col-sm-5">
                                    <select id="default_resource_group" key="default_resource_group"
                                            class="selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            data-none-selected-text="{% trans 'Resource groups automatically assigned to new users on first login' %}"
                                            multiple data-selected-text-format="count > 3"
                                            required>
                                        {% for resource_group in group_list %}
                                            {% if resource_group.group_name|is_in:config.default_resource_group %}
                                                <option value="{{ resource_group.group_name }}"
                                                        selected>{{ resource_group.group_name }}</option>
                                            {% else %}
                                                <option value="{{ resource_group.group_name }}">{{ resource_group.group_name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="api_user_whitelist"
                                       class="col-sm-4 control-label">API_USER_WHITELIST</label>
                                <div class="col-sm-5">
                                    <select id="api_user_whitelist" key="api_user_whitelist"
                                            class="selectpicker show-tick form-control bs-select-hidden"
                                            data-live-search="true"
                                            data-none-selected-text="{% trans 'API User Whitelist' %}"
                                            multiple data-selected-text-format="count > 5"
                                            required>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lock_time_threshold"
                                       class="col-sm-4 control-label">LOCK_TIME_THRESHOLD</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control"
                                           id="lock_time_threshold"
                                           key="lock_time_threshold"
                                           value="{{ config.lock_time_threshold }}"
                                           placeholder="{% trans 'Account lockout time after failed login (seconds)' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lock_cnt_threshold"
                                       class="col-sm-4 control-label">LOCK_CNT_THRESHOLD</label>
                                <div class="col-sm-5">
                                    <input type="number" class="form-control"
                                           id="lock_cnt_threshold"
                                           key="lock_cnt_threshold"
                                           value="{{ config.lock_cnt_threshold }}"
                                           placeholder="{% trans 'Number of failed login attempts before account lockout' %}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="sign_up_enabled"
                                       class="col-sm-4 control-label">SIGN_UP_ENABLED</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="sign_up_enabled" key="sign_up_enabled"
                                                   value="{{ config.sign_up_enabled }}"
                                                   type="checkbox" /> {% trans "Enable user registration" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="watermark_enabled"
                                       class="col-sm-4 control-label">WATERMARK_ENABLED</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="watermark_enabled" key="watermark_enabled"
                                                   value="{{ config.watermark_enabled }}"
                                                   type="checkbox" /> {% trans "Enable watermark" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="enforce_2fa"
                                       class="col-sm-4 control-label">ENFORCE_2FA</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="enforce_2fa" key="enforce_2fa"
                                                   value="{{ config.enforce_2fa }}"
                                                   type="checkbox" /> {% trans "Enforce 2FA on login" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="announcement_content_enabled"
                                       class="col-sm-4 control-label">ANNOUNCEMENT_CONTENT_ENABLED</label>
                                <div class="col-sm-8">
                                    <div class="switch switch-small">
                                        <label>
                                            <input id="announcement_content_enabled" key="announcement_content_enabled"
                                                   value="{{ config.announcement_content_enabled }}"
                                                   type="checkbox"> {% trans "Enable announcements" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="announcement_content"
                                       class="col-sm-4 control-label">ANNOUNCEMENT_CONTENT</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="announcement_content"
                                           key="announcement_content"
                                           value="{{ config.announcement_content }}"
                                           placeholder="{% trans 'Announcement content' %}">
                                            
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="custom_title_suffix"
                                       class="col-sm-4 control-label">CUSTOM_TITLE_SUFFIX</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control"
                                           id="custom_title_suffix"
                                           key="custom_title_suffix"
                                           value="{{ config.custom_title_suffix }}"
                                           placeholder="{% trans 'Append this content to website title and login page, useful for distinguishing multiple Archery instances' %}">
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="form-group">
                            <div class="col-sm-offset-4 col-sm-10">
                                <button id="saveconfig" type="button" class="btn btn-primary">SaveConfig</button>
                            </div>
                        </div>
                    </div>
                    <div id="div-workflow-config" class="form-inline form-group" style="display: none">
                        <h5 class="control-label text-bold" style="color: red">
                            {% trans "Rules:" %} <b>{% trans "Selecting multiple permission groups creates multi-level approval, flowing in selection order, all users in a group can approve" %}</b></h5>
                        <br>
                        <h5 class="control-label text-bold">{% trans "Current Approval Process:" %} <b id="workflow_auditors"></b></h5>
                        <br>
                        <div><h5 style="float:left;" class="control-label text-bold">{% trans "Change Approval Process:" %}</h5></div>
                        <div class="form-group form-inline">
                            <div class="form-group">
                                <input type="text" class="form-control" id="workflow_auditors_text"
                                       disabled="disabled" style="width: 283px">
                            </div>
                            <div class="form-group">
                                <select id="group_auditors" name="group" title="{% trans 'Please select approver permission group' %}"
                                        class="selectpicker show-tick form-control bs-select-hidden"
                                        data-name="{% trans 'Approver' %}" data-placeholder="{% trans 'Approver:' %}" data-live-search="true"
                                        required>
                                    {% for auth_group in auth_group_list %}
                                        <option value="{{ auth_group.name }}">{{ auth_group.name }}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <button id="btn-workflow-config" class="btn btn-default">{% trans "Change" %}</button>
                            <button id="btn-workflow-config-clean" class="btn btn-default">{% trans "Refresh" %}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block js %}
    {% load static %}
    <link href="{% static 'bootstrap-switch/css/bootstrap-switch.min.css' %}" rel="stylesheet" type="text/css"/>
    <script src="{% static 'bootstrap-switch/js/bootstrap-switch.min.js' %}"></script>
    <script>

        $(document).ready(function (){
            // Handle notify_phase_control parameter
            let cfg_value = "{{ config.notify_phase_control }}";
            let phases = ['Apply', 'Pass', 'Execute', 'Cancel'];
            // Default all enabled when notify_phase_control not set
            if (cfg_value === "") {
                for (let i in phases) {
                    let phase = "<option value=\"" + phases[i]+ "\" selected>" + phases[i] + "</option>"
                    $("#notify_phase_control").append(phase)
                }
            } else {
                for (let i=0;i<phases.length;i++) {
                    let phase = "";
                    let cfg_arr = cfg_value.split(',');
                    if (cfg_arr.indexOf(phases[i]) >= 0) {
                        phase = "<option value=\"" + phases[i]+ "\" selected>" + phases[i] + "</option>"
                    } else {
                        phase = "<option value=\"" + phases[i]+ "\">" + phases[i] + "</option>"
                    }
                    $("#notify_phase_control").append(phase)
                }
            }
            $("#notify_phase_control").selectpicker('render');
            $("#notify_phase_control").selectpicker('refresh');

            // Handle api_user_whitelist parameter
            let api_config = "{{ config.api_user_whitelist }}";
            $.ajax({
                type: "post",
                url: "/user/list/",
                dataType: "json",
                success: function (data) {
                    if (data.status === 0) {
                        let users = data.data;
                        let user_arr = api_config.split(',');
                        for (let i=0;i<users.length;i++) {
                            let user = "";
                            if (user_arr.indexOf(users[i].id.toString()) >= 0) {
                                user = "<option value=\"" + users[i].id+ "\" selected>" + users[i].display + "(" + users[i].username + ")</option>"
                            } else {
                                user = "<option value=\"" + users[i].id+ "\">" + users[i].display + "(" + users[i].username + ")</option>"
                            }
                            $("#api_user_whitelist").append(user)
                            $("#api_user_whitelist").selectpicker('render');
                            $("#api_user_whitelist").selectpicker('refresh');
                        }
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });

            
            // Handle sms_provider parameter
            function provider_display(provider) {
                if (provider === 'disabled') {
                    return 'Close'
                } else if (provider === 'aliyun') {
                    return 'Aliyun'
                } else if (provider === 'tencent') {
                    return 'Tencent Cloud'
                }
            }
            let sms_provider = "{{ config.sms_provider }}";
            if (sms_provider === 'disabled' || sms_provider === '') {
                $("#aliyun_sms").hide();
                $("#tencent_sms").hide();
            } else if (sms_provider === 'aliyun') {
                $("#aliyun_sms").show();
                $("#tencent_sms").hide();
            } else if (sms_provider === 'tencent') {
                $("#aliyun_sms").hide();
                $("#tencent_sms").show();
            }
            let providers = ['disabled', 'aliyun', 'tencent'];
            for (let i=0;i<providers.length;i++) {
                let provider;
                if (providers[i] === sms_provider) {
                    provider = "<option value=\"" + providers[i]+ "\" selected>" + provider_display(providers[i]) + "</option>"
                } else {
                    provider = "<option value=\"" + providers[i]+ "\">" + provider_display(providers[i]) + "</option>"
                }
                $("#sms_provider").append(provider)
            }
        })

        //Configuration switch
        $("#config").change(function () {
            sessionStorage.setItem('config_type', $("#config").val());
            if ($("#config").val() === '0') {
                $("#div-system-config").show();
                $("#div-workflow").hide();
                $("#div-workflow-config").hide();
                $("#div-system-config").find('input[type="checkbox"]').each(function (i) {
                    if ($(this).val() === 'true') {
                        $(this).bootstrapSwitch('state', true);
                    } else {
                        $(this).bootstrapSwitch('state', false);
                    }
                });
            } else if ($("#config").val() === '1') {
                $("#div-system-config").hide();
                $("#div-workflow").show();
                $("#div-workflow-config").show();
                $("#workflow_type").trigger("change");
            }
        });

        
        $('input[type="checkbox"]').on('switchChange.bootstrapSwitch', function (event, state) {
            let id = $(this).attr("id");
            if (state) {
                $(this).val(true);
                if (id === 'mail') {
                    $("#div-mail-config").show();
                } else if (id === 'ding_to_person') {
                    $("#div-ding-config").show();
                } else if (id === 'auto_review') {
                    $("#div-auto-review-config").show();
                } else if (id === 'wx') {
                    $("#div-wx-config").show();
                } else if (id === 'feishu') {
                    $("#div-feishu-config").show();
                } else if (id === 'data_masking') {
                    $("#div-inception-config").show();
                }
            } else {
                $(this).val(false);
                if (id === 'mail') {
                    $("#mail_ssl").val(false);
                    $("#div-mail-config").hide();
                } else if (id === 'ding_to_person') {
                    $("#div-ding-config").hide();
                } else if (id === 'auto_review') {
                    $("#div-auto-review-config").hide();
                } else if (id === 'wx') {
                    $("#div-wx-config").hide();
                } else if (id === 'feishu') {
                    $("#div-feishu-config").hide();
                } else if (id === 'data_masking') {
                    $("#div-inception-config").hide();
                }
            }
        });

        
        $("#saveconfig").click(function () {
            // When DingTalk personal notification is enabled, company id and secret must be filled
            if ($("#ding_to_person").val() == 'true') {
                var v1 = $("#ding_agent_id").val();
                var v2 = $("#ding_app_key").val();
                var v3 = $("#ding_app_secret").val();
                var v4 = $("#ding_dept_ids").val();
                var v5 = $("#ding_archery_username").val();
                if (v1 == "" || v2 == "" || v3 == "" || v4 == "" | v5 == "") {
                    alert("When DingTalk personal notification is enabled, company id and secret must be filled!");
                    return;
                }
            }
            var sys_config = $("#div-system-config");
            var configs = [];
            sys_config.find('[key]').each(
                function () {
                    var config_item = $(this).attr("key");
                    var config_value = $(this).val();
                    if (Array.isArray(config_value)) {
                        config_value = config_value.join(',')
                    }
                    configs.push({
                        key: config_item,
                        value: config_value
                    });
                }
            );

            $.ajax({
                type: "post",
                url: "/config/change/",
                dataType: "json",
                data: {
                    configs: JSON.stringify(configs)
                },
                complete: function () {
                },
                success: function (data) {
                    if (data.status === 0) {
                        window.location.reload()
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });

        
        $("#group").change(function () {
            $("#workflow_type").trigger('change')
        });

        
        $("#group_auditors").change(function () {
            var auth_group = $(this).find(':selected').attr("disabled", "disabled").val();
            var auditors = $("#workflow_auditors_text").val();
            if (auditors) {
                $("#workflow_auditors_text").val(auditors + '->' + auth_group);
            } else {
                $("#workflow_auditors_text").val(auth_group)
            }
            $('#group_auditors').selectpicker('render');
            $('#group_auditors').selectpicker('refresh');
        });

        
        $("#group_auditors").on("reset", function () {
            $('#group_auditors').selectpicker('val', []);
            $(this).children().removeAttr("disabled");
            $(this).selectpicker("refresh");
        });

        
        $("#btn-workflow-config-clean").click(function () {
            $('#group_auditors').trigger("reset");
            $("#workflow_auditors_text").val('');
        });

        
        $("#workflow_type").change(function () {
            $("#div-workflow-config").show();
            $('#group_auditors').trigger("reset");
            $("#workflow_auditors_text").val('');
            if ($("#group").val()) {
                $.ajax({
                    type: "post",
                    url: "/group/auditors/",
                    dataType: "json",
                    data: {
                        group_name: $("#group").val(),
                        workflow_type: $("#workflow_type").val()
                    },
                    complete: function () {

                    },
                    success: function (data) {
                        if (data.status === 0) {
                            var result = data.data;
                            $("#workflow_auditors").text(result['auditors_display']);
                        } else {
                            alert(data.msg);
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown);
                    }
                });
            }
        });

        
        $("#btn-workflow-config").click(function () {
            if ($("#group").val() && $("#workflow_type").val() && $("#workflow_auditors_text").val()) {
                $(this).addClass('disabled');
                $(this).prop('disabled', true);
                var audit_auth_groups = $("#workflow_auditors_text").val().replace(/->/g, ",");
                $.ajax({
                    type: "post",
                    url: "/group/changeauditors/",
                    dataType: "json",
                    data: {
                        group_name: $("#group").val(),
                        audit_auth_groups: audit_auth_groups,
                        workflow_type: $("#workflow_type").val()
                    },
                    complete: function () {
                        $("#btn-workflow-config").removeClass('disabled');
                        $("#btn-workflow-config").prop('disabled', false);
                    },
                    success: function (data) {
                        if (data.status === 0) {
                            //alert('Changed successfully');
                            $("#workflow_type").trigger("change")
                        } else {
                            alert(data.msg);
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown);
                    }
                });
            } else {
                alert('Please select group, ticket type and approval process!')
            }

        });

        
        $("#check_incption").click(function () {
            $(this).addClass('disabled');
            $(this).prop('disabled', true);
            $.ajax({
                type: "post",
                url: "/check/inception/",
                dataType: "json",
                data: {
                    inception_host: $("#inception_host").val(),
                    inception_port: $("#inception_port").val(),
                    inception_remote_backup_host: $("#inception_remote_backup_host").val(),
                    inception_remote_backup_port: $("#inception_remote_backup_port").val(),
                    inception_remote_backup_user: $("#inception_remote_backup_user").val(),
                    inception_remote_backup_password: $("#inception_remote_backup_password").val(),
                },
                complete: function () {
                    $("#check_incption").removeClass('disabled');
                    $("#check_incption").prop('disabled', false);
                },
                success: function (data) {
                    if (data.status === 0) {
                        alert('Inception test connection successful, please click Save button at bottom of page to take effect!')
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });

        
        $("#check_goincption").click(function () {
            $(this).addClass('disabled');
            $(this).prop('disabled', true);
            $.ajax({
                type: "post",
                url: "/check/go_inception/",
                dataType: "json",
                data: {
                    go_inception_host: $("#go_inception_host").val(),
                    go_inception_port: $("#go_inception_port").val(),
                    go_inception_user: $("#go_inception_user").val(),
                    go_inception_password: $("#go_inception_password").val(),
                    inception_remote_backup_host: $("#inception_remote_backup_host").val(),
                    inception_remote_backup_port: $("#inception_remote_backup_port").val(),
                    inception_remote_backup_user: $("#inception_remote_backup_user").val(),
                    inception_remote_backup_password: $("#inception_remote_backup_password").val(),
                },
                complete: function () {
                    $("#check_goincption").removeClass('disabled');
                    $("#check_goincption").prop('disabled', false);
                },
                success: function (data) {
                    if (data.status === 0) {
                        alert('goInception and backup database test connection successful, please click Save button at bottom of page to take effect!')
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });

        
        $("#check_email").click(function () {
            $(this).addClass('disabled');
            $(this).prop('disabled', true);
            $.ajax({
                type: "post",
                url: "/check/email/",
                dataType: "json",
                data: {
                    mail: $("#mail").val(),
                    mail_ssl: $("#mail_ssl").val(),
                    mail_smtp_server: $("#mail_smtp_server").val(),
                    mail_smtp_port: $("#mail_smtp_port").val(),
                    mail_smtp_user: $("#mail_smtp_user").val(),
                    mail_smtp_password: $("#mail_smtp_password").val(),
                },
                complete: function () {
                    $("#check_email").removeClass('disabled');
                    $("#check_email").prop('disabled', false);
                },
                success: function (data) {
                    if (data.status === 0) {
                        alert('Test email successfully sent to current user, please check and click Save button at bottom of page to take effect!')
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });
        
        // Check backend storage connectivity
        $("#check_storage_conn").click(function () {
            $(this).addClass('disabled');
            $(this).prop('disabled', true);
            var SqlfileStorageType = $("#storage_type").val();
            if (SqlfileStorageType === 'sftp') {
                var formData = {
                    max_export_rows: $("#max_export_rows").val(),
                    storage_type: $("#storage_type").val(),
                    sftp_host: $("#sftp_host").val(),
                    sftp_user: $("#sftp_user").val(),
                    sftp_password: $("#sftp_password").val(),
                    sftp_port: $("#sftp_port").val(),
                    sftp_path: $("#sftp_path").val(),
                    sftp_custom_params: $("#sftp_custom_params").val(),
                }
            } else if (SqlfileStorageType === 's3c') {
                var formData = {
                    max_export_rows: $("#max_export_rows").val(),
                    storage_type: $("#storage_type").val(),
                    s3c_access_key_id: $("#s3c_access_key_id").val(),
                    s3c_access_key_secret: $("#s3c_access_key_secret").val(),
                    s3c_endpoint: $("#s3c_endpoint").val(),
                    s3c_bucket_name: $("#s3c_bucket_name").val(),
                    s3c_region: $("#s3c_region").val(),
                    s3c_path: $("#s3c_path").val(),
                    s3c_custom_params: $("#s3c_custom_params").val(),
                }
            } else if (SqlfileStorageType === 'local') {
                var formData = {
                    max_export_rows: $("#max_export_rows").val(),
                    storage_type: $("#storage_type").val(),
                }
            } else if (SqlfileStorageType === 'azure') {
                var formData = {
                    max_export_rows: $("#max_export_rows").val(),
                    storage_type: $("#storage_type").val(),
                    azure_account_name: $("#azure_account_name").val(),
                    azure_account_key: $("#azure_account_key").val(),
                    azure_container: $("#azure_container").val(),
                    azure_path: $("#azure_path").val(),
                    azure_custom_params: $("#azure_custom_params").val(),
                }
            }
            $.ajax({
                type: "post",
                url: "/check/file_storage_connect/",
                dataType: "json",
                data: formData,
                complete: function () {
                    $("#check_storage_conn").removeClass('disabled');
                    $("#check_storage_conn").prop('disabled', false);
                },
                success: function (data) {
                    if (data.status === 0) {
                        alert('Connection test successful, please click Save button at bottom of page to take effect!')
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });

        
        $("#sync_ding_user").click(function () {
            
            var v1 = $("#ding_agent_id").val();
            var v2 = $("#ding_app_key").val();
            var v3 = $("#ding_app_secret").val();
            var v4 = $("#ding_dept_ids").val();
            var v5 = $("#ding_archery_username").val();
            if (v1 == "" || v2 == "" || v3 == "" || v4 == "" | v5 == "") {
                alert("Please save related configuration information first!");
                return;
            }
            $(this).addClass('disabled');
            $(this).prop('disabled', true);
            $.ajax({
                type: "post",
                url: "/4admin/sync_ding_user/",
                dataType: "json",
                data: {},
                complete: function () {
                    $("#sync_ding_user").removeClass('disabled');
                    $("#sync_ding_user").prop('disabled', false);
                },
                success: function (data) {
                    if (data.status === 0) {
                        alert('Scheduled sync task added and sync triggered, click OK to view task status');
                        window.open('/admin/django_q/schedule/?q=sync_ding_user_id')
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });


        
        $("#sms_provider").change(function () {
            let provider = this.value;
            if (provider === 'disabled') {
                $("#aliyun_sms").hide();
                $("#tencent_sms").hide();
            } else if (provider === 'aliyun') {
                $("#aliyun_sms").show();
                $("#tencent_sms").hide();
            } else if (provider === 'tencent') {
                $("#aliyun_sms").hide();
                $("#tencent_sms").show();
            }
        })

        
        $(document).ready(function () {
            if (sessionStorage.getItem('config_type')) {
                $("#config").val(sessionStorage.getItem('config_type')).trigger("change")
            } else if ($("#config").val()) {
                $("#config").trigger("change")
            }
        })
    </script>
{% endblock %}

